<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Order - MOTION DATA SOLUTIONS </title>
  <link rel="stylesheet" href="assets/css/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Form page specific styles */
    :root{--bg:#2b0b44;--card:#3a154f;--input-bg:#ffffff;--muted:#d1d5db;--accent:#facc15;--green:#10b981}
    body{margin:0;font-family:Inter,system-ui,Arial;background:var(--bg);color:#fff}
  /* center wrapper so header + single card are centered together */
  .wrap{max-width:960px;margin:2rem auto;padding:1rem;display:flex;flex-direction:column;align-items:center}
  /* keep layout simple for this page and center the single card vertically/horizontally */
  .form-grid{display:flex;flex-direction:column;align-items:center;gap:1rem;min-height:calc(100vh - 200px);justify-content:center;width:100%}
  .panel{background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));padding:1.5rem;border-radius:14px;border:1px solid rgba(255,255,255,0.04);width:100%;max-width:720px;box-shadow:0 8px 24px rgba(0,0,0,0.25);transform:scale(1.01)}
    h1{font-size:1.1rem;margin:0 0 .6rem;color:var(--accent);font-weight:800}
    label{display:block;color:#fff;font-weight:700;margin-bottom:.35rem}
    input[type="text"], select, textarea{width:100%;padding:.7rem;border-radius:8px;border:1px solid rgba(0,0,0,0.08);background:var(--input-bg);color:#04111a}
    textarea{min-height:160px;font-family:inherit}
    .center{display:flex;justify-content:center}
    .btn-order{background:var(--green);color:#04261a;border-radius:10px;padding:.6rem 1rem;border:none;font-weight:800;cursor:pointer}
    .muted{color:var(--muted)}
    @media(max-width:820px){.form-grid{grid-template-columns:1fr}}
    .hint{font-size:.9rem;color:var(--muted);margin-top:.35rem}
    .section-title{display:flex;align-items:center;gap:.6rem}
  </style>
</head>
<body>
  <header class="header">
    <div class="container header-content">
      <div class="logo">
        <a href="index.html" class="brand">MOTION DATA SOLUTIONS</a>
      </div>
      <button class="mobile-menu-toggle" id="mobileMenuToggle" aria-label="Toggle navigation" aria-controls="mainNav" aria-expanded="false">
        <i class="fas fa-bars"></i>
      </button>
    </div>
  </header>

  <!-- Sidebar Navigation -->
  <aside class="site-sidebar" id="mainNav" aria-label="Primary navigation">
    <div class="sidebar-header-inline">
      <a href="index.html" class="brand">MOTION DATA SOLUTIONS</a>
      <button class="sidebar-close" aria-label="Close navigation" type="button">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <nav class="sidebar-links">
      <a href="index.html" class="nav-link"><i class="fas fa-home"></i><span>Home</span></a>
      <a href="services.html" class="nav-link"><i class="fas fa-shopping-cart"></i><span>Services</span></a>
      <a href="about.html" class="nav-link"><i class="fas fa-info-circle"></i><span>About</span></a>
      <a href="contact.html" class="nav-link"><i class="fas fa-envelope"></i><span>Contact</span></a>
      <a href="admin.html" class="nav-link"><i class="fas fa-user-shield"></i><span>Admin</span></a>
      <a href="https://wa.me/233256342577" class="nav-link" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i><span>WhatsApp</span></a>
    </nav>
  </aside>
  <div class="wrap">
    <header style="margin-bottom:1rem;text-align:center"><a href="services.html" style="color:var(--accent);text-decoration:none;font-weight:700">&larr; Back</a></header>

    <div class="form-grid">
      <!-- Send Single Order -->
      <section class="panel" aria-labelledby="single-order">
        <div class="section-title">
          <h1 id="single-order">SEND SINGLE ORDER</h1>
        </div>

        <form id="singleForm">
          <div style="margin-top:1rem">
            <label for="msisdn">Type Number</label>
            <input id="msisdn" name="msisdn" type="text" placeholder="must be 10 digits!" pattern="\d{10}" inputmode="numeric" maxlength="10" required>
            <div class="hint">Enter recipient mobile number (10 digits). Example: 0241234567</div>
          </div>

          <div style="margin-top:1rem">
            <label for="email">Your Email</label>
            <input id="email" name="email" type="email" placeholder="you@example.com" required>
            <div class="hint">We will use this email to process the payment receipt.</div>
          </div>

          <div style="margin-top:1rem;display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;align-items:start">
            <div>
              <label for="packageSelectMTN">MTN Packages</label>
              <select id="packageSelectMTN" name="package_mtn">
                <option value="">-- choose a package --</option>
                <!-- MTN options populated by JS -->
              </select>
            </div>

            <div>
              <label for="packageSelectTelecel">Telecel Packages</label>
              <select id="packageSelectTelecel" name="package_telecel">
                <option value="">-- choose a package --</option>
                <!-- Telecel packages not provided; contact option shown by JS -->
              </select>
            </div>

            <div>
              <label for="packageSelectAirtelTigo">AirtelTigo Packages</label>
              <select id="packageSelectAirtelTigo" name="package_airteltigo">
                <option value="">-- choose a package --</option>
                <!-- AirtelTigo options populated by JS -->
              </select>
            </div>
          </div>
          

          <div style="margin-top:1.25rem" class="center">
            <button type="submit" class="btn-order">ORDER</button>
          </div>
        </form>
      </section>


  <script src="assets/js/script.js"></script>
  <!-- Paystack inline script -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
  <script>
    // helper to read query string values
    function qs(name){
      return decodeURIComponent((new RegExp('[?&]'+name+'=([^&]*)').exec(location.search)||[,''])[1]||'');
    }

    // Packages by operator (prices in GHS)
    const packagesByOperator = {
      'AirtelTigo': {
        '1GB': 6.00,
        '2GB': 11.00,
        '3GB': 15.00,
        '4GB': 20.00,
        '5GB': 25.00,
        '6GB': 30.00,
        '7GB': 35.00,
        '8GB': 40.00,
        '10GB': 50.00,
        '20GB': 75.00,
        '30GB': 85.00,
        '40GB': 120.00,
        '50GB': 130.00,
        '100GB': 230.00
      },
      'MTN': {
        '1GB': 6.00,
        '2GB': 11.00,
        '3GB': 16.00,
        '4GB': 21.00,
        '5GB': 26.00,
        '6GB': 32.00,
        '8GB': 42.00,
        '10GB': 50.00,
        '15GB': 70.00,
        '20GB': 95.00,
        '25GB': 115.00,
        '30GB': 135.00,
        '40GB': 175.00,
        '50GB': 215.00
      }
    };

    // Populate a specific select element with packages for the given operator
    function populateSelectForOperator(operator, elementId){
      const sel = document.getElementById(elementId);
      if(!sel) return;
      sel.innerHTML = '<option value="">-- choose a package --</option>';
      const pkgs = packagesByOperator[operator] || {};
      Object.keys(pkgs).forEach(key => {
        const price = pkgs[key];
        const opt = document.createElement('option');
        opt.value = key;
        opt.textContent = `${key} ------- GHS${price.toFixed(2)}` + (operator === 'AirtelTigo' && key === '100GB' ? ' (AirtelTigo only)' : '');
        sel.appendChild(opt);
      });
    }

    // Populate all three selects (MTN, Telecel, AirtelTigo)
    function populateAllPackageSelects(){
      populateSelectForOperator('MTN', 'packageSelectMTN');
      // Telecel packages not provided — show a contact placeholder
      const teleSel = document.getElementById('packageSelectTelecel');
      if(teleSel) teleSel.innerHTML = '<option value="">-- choose a package --</option><option value="contact">Contact us for Telecel bundles</option>';
      populateSelectForOperator('AirtelTigo', 'packageSelectAirtelTigo');
    }

    // Initialize the selects
    populateAllPackageSelects();

    // Prefill operator/package from query string if present: ?operator=MTN&package=10GB or ?package=10GB
    (function preselectFromQuery(){
      const opRaw = qs('operator');
      const pkg = qs('package');
      const op = opRaw ? (opRaw.toLowerCase() === 'mtn' ? 'MTN' : (opRaw.toLowerCase() === 'airteltigo' ? 'AirtelTigo' : (opRaw.toLowerCase() === 'telecel' ? 'Telecel' : ''))) : '';

      if(op){
        // show only the requested operator's select and hide others
        const map = { 'MTN':'packageSelectMTN', 'AirtelTigo':'packageSelectAirtelTigo', 'Telecel':'packageSelectTelecel' };
        const showId = map[op];
        ['packageSelectMTN','packageSelectAirtelTigo','packageSelectTelecel'].forEach(id=>{
          const sel = document.getElementById(id);
          if(!sel) return;
          const container = sel.parentElement;
          if(id === showId){
            container.style.display = '';
          } else {
            container.style.display = 'none';
            sel.value = '';
          }
        });

        // update header to reflect operator
        const hdr = document.getElementById('single-order');
        if(hdr) hdr.textContent = 'SEND SINGLE ORDER — ' + op;

        // preselect package in the shown select if provided
        if(pkg){
          const sel = document.getElementById(showId);
          if(sel){
            for(const opt of sel.options){
              if(opt.value && opt.value.toLowerCase() === pkg.toLowerCase().replace(/%20/g,' ')){ opt.selected = true; break; }
              if(opt.textContent.toLowerCase().includes(pkg.toLowerCase())){ opt.selected = true; break; }
            }
          }
        }
        return;
      }

      // no operator provided: if a package param exists, try to find it across all selects
      if(pkg){
        ['packageSelectMTN','packageSelectAirtelTigo','packageSelectTelecel'].forEach(id=>{
          const sel = document.getElementById(id);
          if(!sel) return;
          for(const opt of sel.options){
            if((opt.value && opt.value.toLowerCase() === pkg.toLowerCase().replace(/%20/g,' ')) || opt.textContent.toLowerCase().includes(pkg.toLowerCase())){ opt.selected = true; return; }
          }
        });
      }
    })();

    // Helper to validate simple email pattern
    function isValidEmail(email){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); }

    // Handle single order submit: launch Paystack inline
    document.getElementById('singleForm').addEventListener('submit', function(e){
      e.preventDefault();
      const msisdn = document.getElementById('msisdn').value.trim();
      const selMTN = document.getElementById('packageSelectMTN') ? document.getElementById('packageSelectMTN').value : '';
      const selTele = document.getElementById('packageSelectTelecel') ? document.getElementById('packageSelectTelecel').value : '';
      const selAirtel = document.getElementById('packageSelectAirtelTigo') ? document.getElementById('packageSelectAirtelTigo').value : '';
      const email = document.getElementById('email').value.trim();

      if(!/^\d{10}$/.test(msisdn)){ alert('Please enter a valid 10 digit number'); return; }
      if(!email || !isValidEmail(email)){ alert('Please enter a valid email address'); return; }

      const selections = [];
      if(selMTN) selections.push({ operator: 'MTN', pkg: selMTN });
      if(selTele) selections.push({ operator: 'Telecel', pkg: selTele });
      if(selAirtel) selections.push({ operator: 'AirtelTigo', pkg: selAirtel });

      if(selections.length === 0){ alert('Please select a package from MTN, Telecel or AirtelTigo'); return; }
      if(selections.length > 1){ alert('Please select only one package at a time'); return; }

      const { operator, pkg } = selections[0];
      const price = (packagesByOperator[operator] && packagesByOperator[operator][pkg]) || null;
      if(price === null || typeof price === 'undefined'){ alert('Unknown package selected or price not available for this operator'); return; }

      // Paystack expects amount in the smallest currency unit (pesewas for GHS)
      const amountInPesewas = Math.round(price * 100);

      // Using live Paystack key
      const publicKey = 'pk_live_91cfdef8bb6ab204ba3ec685224bbe3ff7aa0720';

      if(!window.PaystackPop){ alert('Payment library failed to load. Check your internet connection.'); return; }

      const handler = PaystackPop.setup({
        key: publicKey,
        email: email,
        amount: amountInPesewas,
        currency: 'GHS',
        ref: 'ORD-' + Date.now(),
        metadata: {
          custom_fields: [
            { display_name: 'Mobile', variable_name: 'mobile', value: msisdn },
            { display_name: 'Operator', variable_name: 'operator', value: operator },
            { display_name: 'Package', variable_name: 'package', value: pkg }
          ]
        },
        callback: function(response){
          // You should verify the transaction on the server using the reference before fulfilling the order.
          alert('Payment successful! Reference: ' + response.reference);
          // Redirect to services or a thank-you page
          window.location.href = 'services.html';
        },
        onClose: function(){
          alert('Payment window closed. If you cancelled by mistake you can try again.');
        }
      });

      handler.openIframe();
    });

    // Guard the optional bulk load button handler in case the element doesn't exist on this page
    const loadBtn = document.getElementById('loadBtn');
    if(loadBtn){
      loadBtn.addEventListener('click', function(){
        const data = document.getElementById('bulkTextarea').value.trim();
        if(!data){ alert('Please paste orders into the textarea'); return; }
        const lines = data.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
        // basic validation of first few lines
        for(const l of lines.slice(0,5)){
          if(!/^\d{10},\s*\w+/i.test(l)){
            alert('Invalid format on line: ' + l + '\nExpected: 0241234567,1GB');
            return;
          }
        }
        alert('Loaded ' + lines.length + ' orders (demo)');
        document.getElementById('bulkTextarea').value = '';
      });
    }
  </script>
</body>
</html>
